<!-- Page Boutiques - N√¥t√©a -->
<div class="boutiques-page py-5">
  <div class="container">
    
    <!-- Header -->
    <div class="text-center mb-5">
      <h1 class="h2 font-heading text-gold-light mb-2" style="letter-spacing: 2px;">Nos Boutiques</h1>
      <p class="text-muted-custom">Trouvez les parfumeries pr√®s de chez vous</p>
    </div>

    <!-- Search Section -->
    <div class="mb-5">
      
      <!-- Geolocation Button -->
      <button class="btn btn-primary w-100 mb-4 py-3 d-flex align-items-center justify-content-center gap-2" 
              (click)="searchNearby()" 
              [disabled]="loading || locationLoading">
        <span style="font-size: 1.2rem;">üìç</span>
        <span *ngIf="!locationLoading">Autour de moi</span>
        <span *ngIf="locationLoading" class="d-flex align-items-center gap-2">
          <span class="spinner-border spinner-border-sm"></span>
          Localisation...
        </span>
      </button>

      <!-- Filters -->
      <div class="row g-3">
        
        <!-- City Filter -->
        <div class="col-12 col-md-5">
          <label class="form-label">Ville</label>
          <select class="form-select" [(ngModel)]="selectedCity" (change)="applyFilters()">
            <option value="">Toutes les villes</option>
            <option *ngFor="let city of cities" [value]="city">{{ city }}</option>
          </select>
        </div>

        <!-- Brand Filter -->
        <div class="col-12 col-md-5">
          <label class="form-label">Marque</label>
          <select class="form-select" [(ngModel)]="selectedBrand" (change)="applyFilters()">
            <option value="">Toutes les marques</option>
            <option *ngFor="let brand of brands" [value]="brand">{{ brand }}</option>
          </select>
        </div>

        <!-- Reset Button -->
        <div class="col-12 col-md-2 d-flex align-items-end">
          <button class="btn btn-outline-secondary w-100" 
                  (click)="resetFilters()" 
                  *ngIf="selectedCity || selectedBrand || searchMode === 'nearby'">
            R√©initialiser
          </button>
        </div>

      </div>
    </div>

    <!-- Loading State -->
    <div class="text-center py-5" *ngIf="loading">
      <div class="loading-spinner mx-auto mb-3"></div>
      <p class="text-muted-custom">Chargement des boutiques...</p>
    </div>

    <!-- Error State -->
    <div class="text-center py-5" *ngIf="error && !loading">
      <p class="text-danger">{{ error }}</p>
    </div>

    <!-- Results -->
    <div *ngIf="!loading && filteredBoutiques.length > 0">
      
      <!-- Results Count -->
      <p class="text-muted-custom small mb-4">
        {{ filteredBoutiques.length }} boutique{{ filteredBoutiques.length > 1 ? 's' : '' }}
        <span *ngIf="selectedCity"> √† {{ selectedCity }}</span>
        <span *ngIf="searchMode === 'nearby'"> pr√®s de vous</span>
      </p>

      <!-- Stores Grid -->
      <div class="row g-4">
        <div class="col-12 col-md-6 col-lg-4" *ngFor="let boutique of filteredBoutiques">
          <div class="card h-100 store-card">
            <div class="card-body">
              
              <!-- Header -->
              <div class="d-flex justify-content-between align-items-start mb-3 pb-3 border-bottom border-gold-subtle">
                <div>
                  <h5 class="card-title font-heading text-cream mb-1" style="font-size: 1.1rem;">
                    {{ boutique.name }}
                  </h5>
                  <span class="text-gold small">{{ boutique.brand }}</span>
                </div>
                <span class="badge bg-amber" *ngIf="boutique.distance">
                  {{ formatDistance(boutique.distance) }}
                </span>
              </div>
              
              <!-- Details -->
              <div class="mb-3">
                <p class="d-flex align-items-start gap-2 text-muted-custom small mb-2">
                  <span>üìç</span>
                  <span>{{ boutique.address }}, {{ boutique.postalCode }} {{ boutique.city }}</span>
                </p>
                <p class="d-flex align-items-start gap-2 text-muted-custom small mb-2" *ngIf="boutique.openingHours">
                  <span>üïê</span>
                  <span>{{ boutique.openingHours }}</span>
                </p>
                <p class="d-flex align-items-start gap-2 text-muted-custom small mb-0" *ngIf="boutique.phone">
                  <span>üìû</span>
                  <span>{{ boutique.phone }}</span>
                </p>
              </div>
              
              <!-- Actions -->
              <div class="d-flex flex-wrap gap-2">
                <button class="btn btn-outline-primary btn-sm flex-grow-1" (click)="openMaps(boutique)">
                  üó∫Ô∏è Itin√©raire
                </button>
                <button class="btn btn-outline-secondary btn-sm" 
                        (click)="callPhone(boutique.phone)" 
                        *ngIf="boutique.phone">
                  üìû
                </button>
                <button class="btn btn-outline-secondary btn-sm" 
                        (click)="openWebsite(boutique.website)" 
                        *ngIf="boutique.website">
                  üåê
                </button>
              </div>
              
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div class="text-center py-5" *ngIf="!loading && !error && filteredBoutiques.length === 0">
      <p class="text-muted-custom mb-3">Aucune boutique trouv√©e avec ces crit√®res</p>
      <button class="btn btn-outline-primary" (click)="resetFilters()">
        Voir toutes les boutiques
      </button>
    </div>

  </div>
</div>
