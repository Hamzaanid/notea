<div class="boutiques">
  
  <!-- Header Section -->
  <section class="boutiques-header">
    <div class="header-content">
      <h1 class="page-title">
        {{ mode === 'availability' ? 'DisponibilitÃ© en magasin' : 'Magasins Sephora' }}
      </h1>
      <p class="page-subtitle">
        {{ mode === 'availability' ? 'Trouvez ce produit prÃ¨s de chez vous' : 'Trouvez les magasins Sephora aux Ã‰tats-Unis' }}
      </p>
    </div>

    <!-- Produit sÃ©lectionnÃ© (mode availability) -->
    <div class="selected-product" *ngIf="mode === 'availability' && selectedProduct">
      <div class="product-info">
        <span class="product-brand">{{ selectedProduct.brandName }}</span>
        <span class="product-name">{{ selectedProduct.displayName }}</span>
        <span class="product-sku" *ngIf="skuIdUsed">SKU: {{ skuIdUsed }}</span>
      </div>
      <button class="back-btn" (click)="goToCatalogue()">
        â† Retour au catalogue
      </button>
    </div>
  </section>

  <!-- Search Section -->
  <section class="search-section">

    <!-- SÃ©lection de ville US -->
    <div class="city-selector">
      <label class="filter-label">ğŸ“ Choisir une ville</label>
      <select class="filter-select city-select" [(ngModel)]="selectedUSCity" (change)="onCityChange()">
        <option *ngFor="let city of usCities" [value]="city.name + ', ' + city.state">
          {{ city.name }}, {{ city.state }}
        </option>
      </select>
    </div>

    <!-- Filters -->
    <div class="filters-container">
      
      <!-- Radius filter -->
      <div class="filter-group">
        <label class="filter-label">Rayon</label>
        <select class="filter-select" [(ngModel)]="searchRadius" (change)="onRadiusChange()">
          <option [value]="10">~15 km</option>
          <option [value]="25">~40 km</option>
          <option [value]="50">~80 km</option>
          <option [value]="100">~160 km</option>
        </select>
      </div>

      <!-- City filter (from results) -->
      <div class="filter-group" *ngIf="availableCities.length > 1">
        <label class="filter-label">Quartier</label>
        <select class="filter-select" [(ngModel)]="selectedStoreCity" (change)="applyFilters()">
          <option value="">Tous</option>
          <option *ngFor="let city of availableCities" [value]="city">{{ city }}</option>
        </select>
      </div>

      <!-- Store type filter -->
      <div class="filter-group">
        <label class="filter-label">Type</label>
        <select class="filter-select" [(ngModel)]="selectedStoreType" (change)="applyFilters()">
          <option value="">Tous</option>
          <option value="SEPHORA">Sephora</option>
          <option value="SIKLS">Sephora @ Kohl's</option>
        </select>
      </div>

      <!-- Reset button -->
      <button class="reset-btn" (click)="resetFilters()" *ngIf="selectedStoreCity || selectedStoreType">
        RÃ©initialiser
      </button>

    </div>
  </section>

  <!-- Loading -->
  <div class="loading-container" *ngIf="loading">
    <div class="loader"></div>
    <p class="loading-text">Chargement des magasins...</p>
  </div>

  <!-- Error -->
  <div class="error-container" *ngIf="error && !loading">
    <p class="error-text">{{ error }}</p>
    <button class="back-btn" (click)="goToCatalogue()" *ngIf="mode === 'availability'">
      Retour au catalogue
    </button>
  </div>

  <!-- Results -->
  <section class="results-section" *ngIf="!loading && filteredStores.length > 0">
    <p class="results-count">
      {{ filteredStores.length }} magasin{{ filteredStores.length > 1 ? 's' : '' }}
      <span *ngIf="mode === 'availability'"> avec ce produit en stock</span>
      <span> Ã  {{ selectedUSCity }}</span>
    </p>

    <div class="stores-grid">
      <div class="store-card" *ngFor="let store of filteredStores" [class.out-of-stock]="store.availabilityStatus === 'Out of Stock'">
        
        <div class="store-header">
          <div class="store-info">
            <h3 class="store-name">{{ store.displayName }}</h3>
            <span class="store-type" [class.sikls]="store.storeType === 'SIKLS'">
              {{ getStoreTypeLabel(store.storeType) }}
            </span>
          </div>
          <span class="store-distance" *ngIf="store.distance">
            {{ formatDistance(store.distance) }}
          </span>
        </div>

        <!-- DisponibilitÃ© (mode availability) -->
        <div class="availability-badge" *ngIf="mode === 'availability'" [ngClass]="getAvailabilityClass(store)">
          <span *ngIf="store.availabilityStatus === 'In Stock'">
            âœ“ En stock
            <span class="stock-count" *ngIf="store.inStoreAvailability">({{ store.inStoreAvailability }} dispo)</span>
          </span>
          <span *ngIf="store.availabilityStatus === 'Out of Stock'">âœ— Rupture</span>
          <span *ngIf="!store.availabilityStatus">âœ“ Disponible</span>
        </div>

        <div class="store-details">
          <p class="store-address">
            <span class="detail-icon">ğŸ“</span>
            {{ getFullAddress(store) }}
          </p>
          
          <p class="store-hours">
            <span class="detail-icon">ğŸ•</span>
            {{ getTodayHours(store) }}
          </p>
          
          <p class="store-phone" *ngIf="store.phone">
            <span class="detail-icon">ğŸ“</span>
            {{ formatPhone(store.phone) }}
          </p>

          <p class="store-mall" *ngIf="store.mallName">
            <span class="detail-icon">ğŸ¬</span>
            {{ store.mallName }}
          </p>
        </div>

        <!-- Services disponibles -->
        <div class="store-services" *ngIf="hasServices(store)">
          <span class="service-badge" *ngIf="store.isBopisable" title="Retrait en magasin">
            ğŸ›ï¸ Retrait
          </span>
          <span class="service-badge" *ngIf="store.isCurbsideEnabled" title="Curbside">
            ğŸš— Curbside
          </span>
          <span class="service-badge" *ngIf="store.samedayDeliveryEnabled" title="Livraison jour mÃªme">
            âš¡ Express
          </span>
          <span class="service-badge" *ngIf="store.isOnlineReservationEnabled" title="RÃ©servation">
            ğŸ“… RÃ©serv.
          </span>
        </div>

        <div class="store-actions">
          <button class="action-btn primary" (click)="openMaps(store)">
            ğŸ—ºï¸ ItinÃ©raire
          </button>
          
          <button class="action-btn" (click)="callPhone(store.phone)" *ngIf="store.phone">
            ğŸ“
          </button>
        </div>

      </div>
    </div>
  </section>

  <!-- Empty state -->
  <div class="empty-state" *ngIf="!loading && !error && filteredStores.length === 0 && stores.length > 0">
    <p>Aucun magasin trouvÃ© avec ces filtres</p>
    <button class="reset-btn" (click)="resetFilters()">
      Voir tous les magasins
    </button>
  </div>

</div>
